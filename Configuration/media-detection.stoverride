name: 流媒体检测面板
author: xiaomingyve
description: 流媒体解锁状态检测面板 | 支持Netflix/Disney+/YouTube等七项服务检测
updateURL: https://example.com/update

[override]
tiles = [
    {
        "type": "custom",
        "title": "流媒体检测",
        "icon": "play.tv.fill",
        "panel": "streaming_detect_panel",
        "color": "#FF6B6B"
    }
]

panels = [
    {
        "id": "streaming_detect_panel",
        "title": "流媒体解锁检测",
        "items": [
            {
                "type": "script",
                "title": "ChatGPT",
                "icon": "brain.head.profile",
                "script": [
                    "async (callback) => {",
                    "  try {",
                    "    const start = Date.now();",
                    "    const res = await $httpClient.get('https://chat.openai.com');",
                    "    callback({",
                    "      label: res.status === 403 ? '封锁' : '解锁',",
                    "      color: res.status === 403 ? '#FF6B6B' : '#4CAF50',",
                    "      region: res.headers['cf-ray']?.split('-')[1] || '未知'",
                    "    })",
                    "  } catch (error) {",
                    "    callback({",
                    "      label: '封锁',",
                    "      color: '#FF6B6B',",
                    "      region: 'N/A'",
                    "    })",
                    "  }",
                    "}"
                ],
                "interval": 3600
            },
            {
                "type": "script",
                "title": "YouTube",
                "icon": "play.rectangle.fill",
                "script": [
                    "async (callback) => {",
                    "  try {",
                    "    const res = await $httpClient.head('https://www.youtube.com/redirect?q=check');",
                    "    const region = res.headers['x-country-code'] || 'US';",
                    "    callback({",
                    "      label: '解锁',",
                    "      color: '#4CAF50',",
                    "      region: region",
                    "    })", 
                    "  } catch {",
                    "    callback({",
                    "      label: '封锁',",
                    "      color: '#FF6B6B',",
                    "      region: 'N/A'",
                    "    })",
                    "  }",
                    "}"
                ],
                "interval": 3600
            },
            {
                "type": "script",
                "title": "Netflix",
                "icon": "n.circle.fill",
                "script": [
                    "async (callback) => {",
                    "  try {",
                    "    const res = await $httpClient.get('https://www.netflix.com/title/80018499');",
                    "    const regionRes = await $httpClient.get('https://api.netflix.com/geolocation');",
                    "    callback({",
                    "      label: res.status === 200 ? '解锁' : '封锁',",
                    "      color: res.status === 200 ? '#4CAF50' : '#FF6B6B',",
                    "      region: regionRes.data?.country || '未知'",
                    "    })",
                    "  } catch {",
                    "    callback({",
                    "      label: '封锁',",
                    "      color: '#FF6B6B',",
                    "      region: 'N/A'",
                    "    })",
                    "  }",
                    "}"
                ],
                "interval": 3600
            },
            {
                "type": "script",
                "title": "Disney+",
                "icon": "d.circle.fill",
                "script": [
                    "async (callback) => {",
                    "  try {",
                    "    const res = await $httpClient.get('https://global.edge.bamgrid.com/region');",
                    "    callback({",
                    "      label: '解锁',",
                    "      color: '#4CAF50',",
                    "      region: res.data?.country || 'US'",
                    "    })",
                    "  } catch {",
                    "    callback({",
                    "      label: '封锁',",
                    "      color: '#FF6B6B',",
                    "      region: 'N/A'",
                    "    })",
                    "  }",
                    "}"
                ],
                "interval": 3600
            },
            {
                "type": "script",
                "title": "TikTok",
                "icon": "t.circle.fill",
                "script": [
                    "async (callback) => {",
                    "  try {",
                    "    const res = await $httpClient.get('https://www.tiktok.com/');",
                    "    const region = res.headers['x-tt-region'] || '未知';",
                    "    callback({",
                    "      label: res.status === 200 ? '解锁' : '封锁',",
                    "      color: res.status === 200 ? '#4CAF50' : '#FF6B6B',",
                    "      region: region",
                    "    })",
                    "  } catch {",
                    "    callback({",
                    "      label: '封锁',",
                    "      color: '#FF6B6B',",
                    "      region: 'N/A'",
                    "    })",
                    "  }",
                    "}"
                ],
                "interval": 3600
            },
            {
                "type": "script",
                "title": "Amazon Prime",
                "icon": "a.circle.fill",
                "script": [
                    "async (callback) => {",
                    "  try {",
                    "    const res = await $httpClient.get('https://www.primevideo.com/region');",
                    "    callback({",
                    "      label: res.data?.isAllowed ? '解锁' : '封锁',",
                    "      color: res.data?.isAllowed ? '#4CAF50' : '#FF6B6B',",
                    "      region: res.data?.countryCode || '未知'",
                    "    })",
                    "  } catch {",
                    "    callback({",
                    "      label: '封锁',",
                    "      color: '#FF6B6B',",
                    "      region: 'N/A'",
                    "    })",
                    "  }",
                    "}"
                ],
                "interval": 3600
            },
            {
                "type": "script",
                "title": "HBO Max",
                "icon": "h.circle.fill",
                "script": [
                    "async (callback) => {",
                    "  try {",
                    "    const res = await $httpClient.get('https://comet.api.hbo.com/geo');",
                    "    callback({",
                    "      label: res.data?.allowed ? '解锁' : '封锁',",
                    "      color: res.data?.allowed ? '#4CAF50' : '#FF6B6B',",
                    "      region: res.data?.country || '未知'",
                    "    })",
                    "  } catch {",
                    "    callback({",
                    "      label: '封锁',",
                    "      color: '#FF6B6B',",
                    "      region: 'N/A'",
                    "    })",
                    "  }",
                    "}"
                ],
                "interval": 3600
            }
        ]
    }
]
